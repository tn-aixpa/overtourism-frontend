<it-card background="true" class="p-4">

  <form (ngSubmit)="onSubmit()" #form="ngForm">
    <div class="table-responsive mb-4">
      <table class="table table-borderless">
        <tbody>
          <!-- Titolo -->
          <tr>
            <td class="fw-bold w-25">
              <label for="title">{{ 'problems.fields.title' | translate }}</label>
            </td>
            <td>
                <it-input id="title" name="name" [(ngModel)]="model.name" required
                          placeholder="{{ 'problems.fields.titlePlaceholder' | translate }}"></it-input>
            </td>
          </tr>

          <!-- Obiettivo -->
          <tr>
            <td class="fw-bold w-25">
              <label for="objective">{{ 'problems.fields.objective' | translate }}</label>
            </td>
            <td>
                <it-textarea id="objective" name="objective" [(ngModel)]="model.objective" [rows]="4" required
                             placeholder="{{ 'problems.fields.objectivePlaceholder' | translate }}"></it-textarea>
              
            </td>
          </tr>

          <!-- Descrizione del problema -->
          <tr>
            <td class="fw-bold w-25">
              <label for="descriptionProblem">{{ 'problems.fields.descriptionProblem' | translate }}</label>
            </td>
            <td>
                <it-textarea id="descriptionProblem" name="descriptionProblem" [(ngModel)]="model.descriptionProblem" required
                             [rows]="4"
                             placeholder="{{ 'problems.fields.descriptionProblemPlaceholder' | translate }}"></it-textarea>
             
            </td>
          </tr>

          <!-- Categoria -->
          <tr>
            <td class="fw-bold w-25">
              <label>{{ 'problems.fields.category' | translate }}</label>
            </td>
            <td>
                <fieldset>
                  <legend>{{ 'problems.fields.group' | translate }}</legend>
                  <it-checkbox *ngFor="let cat of availableGroups" 
                               [(ngModel)]="model.groups[cat.key]"
                               name="category_{{cat.key}}"
                               label="{{ cat.label | translate }}"
                               inline="true"> 
                  </it-checkbox>
                </fieldset>
              
            </td>
          </tr>

          <!-- Dati e tecnologie rilevanti -->
          <tr>
            <td class="fw-bold w-25">
              <label>{{ 'problems.fields.resources' | translate }}</label>
            </td>
            <td>
                <!-- Aggiungi nuova risorsa -->
                <div class="d-flex align-items-center mb-3">
                  <it-input [(ngModel)]="newResource" name="newResource"
                            placeholder="{{ 'problems.fields.resourcePlaceholder' | translate }}"
                            style="flex: 1; min-width: 0;">
                  </it-input>
                  <button type="button" class="btn btn-outline-primary ms-2 rounded-circle p-0"
                          style="width:36px; height:36px; display:flex; align-items:center; justify-content:center;"
                          (click)="addResource()">
                    <span class="material-icons" style="font-size:22px;">add</span>
                  </button>
                </div>

              <!-- Lista risorse -->
              <div class="d-flex flex-column gap-2">
                <div *ngFor="let res of model.resources; let i = index"
                     class="border rounded p-2 d-flex justify-content-between align-items-start"
                     style="background-color: #f8f9fa;">
                  <div style="word-break: break-word; flex: 1;">
                    <a *ngIf="isUrl(res)" [href]="res" target="_blank" class="text-decoration-none">{{ res }}</a>
                    <span *ngIf="!isUrl(res)">{{ res }}</span>
                  </div>
                  <button  type="button" class="btn-close btn-close-sm ms-2 mt-1"
                          aria-label="Remove" (click)="removeResource(i)"></button>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- footer grigio con pulsante salva -->
    <div class="border-top pt-3 mt-4 d-flex justify-content-end">
      <button itButton="primary" type="submit" [disabled]="form.invalid ?? false">
        {{ 'common.save' | translate }}
      </button>
    </div>
  </form>



  <!-- Componente proposta -->
  <!-- <app-proposal-create *ngIf="showProposalForm"
></app-proposal-create> -->
   <!-- <div *ngIf="showProposalForm">
    proposta
   </div>    [problemId]="savedProblemId -->
</it-card>

<app-back-button></app-back-button>
